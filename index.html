<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, user-scalable=no">
      <title> MakeNameTag</title>

      <!-- Font -->
      <link href="http://fonts.googleapis.com/earlyaccess/notosansgothic.css" rel="stylesheet">
      <link href="http://fonts.googleapis.com/earlyaccess/notosanskr.css" rel="stylesheet">

      <!-- Bootstrap -->
      <link href="bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

      <!-- CDN -->
      <link rel="stylesheet" href="./css/style.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
      <script src="./js/canvas2image.js"></script>
      <script src="./js/html2canvas.js"></script>

      <!-- favicon -->
      <link rel="shortcut icon" id="favicon" type="image/png" href="favicon.png">

      <!-- 스타일 적용 테스트 -->
      <style type="text/css">
      </style>
    </head>

    <body>
      <div calss = "container">
        <div class="nav-bar">
          <nav class="top-header">
            <a href="./index.html" title="nametag" class="nametag">
              <!-- 메뉴 바 왼쪽 : 타이틀 로고 -->
              <span id ="title"> NAMETAG </span>
            </a>
            <div style="float: right!important;margin-right:0">
              <div id="informationBox">
                <div class="bubble">
                          <dl>
                            <dt>Input Area</dt>
                            <dd>이름, 회사, 등을 명찰에 적용할 정보를 입력합니다.</dd>
                            <dt>Preview Area</dt>
                            <dd>입력한 값이 적용된 명찰을 미리 확인할 수 있습니다.</dd>
                            <dt>Generation</dt>
                            <dd>명찰을 PNG 파일로 생성합니다.</dd>
                            <dt>Share</dt>
                            <dd>생성한 명찰을 SNS로 공유할 수 있습니다.</dd>
                          </dl>
                </div>
              </div>
              <span class="btn glyphicon glyphicon-info-sign"
                    id = "infoToggle" style="padding : 0px; color:white; font-size:20px;"
                    aria-hidden="true"></span>
              <div style="clear:right"></div>
            </div>

          </nav>
        </div>

      <div calss = "container">
          <!-- 레이아웃을 위한 빈 컬럼 -->
          <div class="col-md-2"></div>
          <!-- 입력 영역 -->
          <div class="col-md-4">
            <div class="custom-area text-center" >
                <h1>Input Area</h1>
                <form id="userInput" class="" action="index.html" method="post">
                <div class="input">
                    <div class="form-group">
                      <input type="text" class="form-control" id="InputName" placeholder ="name">
                    </div>
                    <div class="form-group">
                      <input type="text" class="form-control" id="InputCorp" placeholder ="corp">
                    </div>
                    <div class="form-group">
                      <input type="text" class="form-control" id="InputPosition" placeholder ="position">
                    </div>

                      <div class="language">
                        <select class="form-control selBox" id="selLanguage">
                          <option value="c">Language</option>
                          <option value="c">C</option>
                          <option value="cpp">C++</option>
                          <option value="objc">Objective-C</option>
                          <option value="java">JAVA</option>
                          <option value="javascript">Javascript</option>
                          <option value="python">Python</option>
                          <option value="swift">Swift</option>
                        </select>
                      </div>
                      <div class="theme">
                        <select class="form-control selBox" id="selTheme">
                          <option value="default">Theme</option>
                          <option value="default">default</option>
                          <option value="synhi">synhi</option>
                          <option value="sunset">sunset</option>
                          <option value="ghb">ghb</option>
                          <option value="dark">dark</option>
                          <option value="mono">mono</option>
                          <option value="eclipse">eclipse</option>
                        </select>
                      </div>
                </div>
            </div>
          </div>
          <!-- 미리보기 영역 -->
          <div class="col-md-4 bottom-padding">
            <div class="preveiw-area text-center">
                <h1>Preview Area</h1>
                <div class="nameTag">
        					<div class="preview" id="cardPreview">
        						<span class="varName"><span class="varType"></span> name <span class="symbol">=</span> </span>
        						<span class="name">"name"</span><span class="semicolon symbol"></span>
        						<span class="comment"><span class="cstart"></span><span class="position">position</span><span class="cend"></span></span>
        						<span class="company">company</span>
        					</div>
                </div>
            </div>
          </div>
          <div class="col-md-2"></div>
        </div>
        </div>
      </div>

      <!-- <div class="footer"> -->
        <div class="action-btn">
          <input class="btn btn-success generation" type="button" value="Generation">
        </div>
      <!-- </div> -->
  </form>
<div id="resultArea" class="text-center" >
  <div id="resultBackground"></div>
  <div id="resultImage"></div>
  <div style="margin-top:20px">
    <input class="btn btn-info share" type="button" value="Share">
    <a class="btn btn-success" href="#" role="button" id="downloadBtn" download="NameTag.png">Download</a>
    </div>
</div>
<script>
var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
        }
    }
};
var cardLangTemplate = {
  swift : { varType: 'let ', semicolon : false, commentStart: '/*', commentEnd: '*/', pointer:false, atsign:false},
  c     : { varType: 'char[] ', semicolon: true, commentStart: '/*', commentEnd: '*/', pointer:false, atsign:false },
  cpp   : { varType: 'std::string', semicolon: true, commentStart: '/*', commentEnd: '*/', pointer:false, atsign:false },
  objc   : { varType: 'NSString', semicolon: true, commentStart: '/*', commentEnd: '*/', pointer:true, atsign:true },
  python: { varType: '', semicolon: false, commentStart: '\'\'\'', commentEnd: '\'\'\'', pointer:false, atsign:false },
  javascript: { varType: 'var', semicolon: true, commentStart: '/*', commentEnd: '*/', pointer:false, atsign:false },
  java  : { varType: 'String', semicolon: true, commentStart: '/*', commentEnd: '*/', pointer:false, atsign:false }
};
var cardColorTemplate = {
  default : { bg: '#fff', varType :'#3a95ae', varName : '#000', str : '#b22821', comment : '#008d14', txt:'#000'},
  synhi  : { bg: '#fff', varType :'#007020', varName : '#bb60d5', str : '#4070a0', comment : '#60a0b0', txt:'#000'},
  sunset  : { bg: '#fffceb', varType :'#375788', varName : '#000', str : '#e63b3f', comment : '#d08631', txt:'#000'},
  ghb  : { bg: '#fff', varType :'#a41f5b', varName : '#333333', str : '#db4d1d', comment : '#a79896', txt:'#333333'},
  dark  : { bg: '#0b152b', varType :'#fbe04c', varName : '#4c509a', str : '#66ca51', comment : '#bcbcbc', txt:'#fff'},
  mono  : { bg: '#272822', varType :'#f34683', varName : '#ede8e5', str : '#ebdf8c', comment : '#888372', txt:'#ede8e5' },
  eclipse : { bg: '#272822', varType :'#66d9ef', varName : '#f8f8f2', str : '#e6db74', comment : '#75715e', txt:'#f8f8f2' }
};

$(document).ready(function() {
  var isMobile = function() {
    try{ document.createEvent("TouchEvent"); return true; }
    catch(e){ return false; }
  }
  // 입력 폼에 값이 변하면 프리뷰에 적용되도록 설정

  // 이름
  $('#InputName').on("change paste keyup", function() {
    //console.log($(this).val());
    $('#cardPreview .name').text('"' + $(this).val() + '"');
  });
  // 직급
  $('#InputPosition').on("change paste keyup", function() {
    //console.log($(this).val());
    $('#cardPreview .position').text($(this).val());
  });
  // 회사
  $('#InputCorp').on("change paste keyup", function() {
    //console.log($(this).val());
    $('#cardPreview .company').text($(this).val());
  });

  /* 언어 선택 변경 처리 함수 */
  var changeLanguage = function(lang) {
    if (typeof cardLangTemplate[lang] == "object") { // 선택한 언어가 배열에 있으면 적용
      $('#cardPreview .varType').text(cardLangTemplate[lang].varType);
      // 세미콜론
      if (cardLangTemplate[lang].semicolon) {
        $('#cardPreview .semicolon').text(";");
      }else {
        $('#cardPreview .semicolon').text("");
      }
      // 주석
      $('#cardPreview .comment .cstart').text(cardLangTemplate[lang].commentStart + ' ');
      if (cardLangTemplate[lang].commentEnd.length > 0) {
        $('#cardPreview .comment .cend').text(' ' + cardLangTemplate[lang].commentEnd);
      }else {
        $('#cardPreview .comment .cend').text('');
      }
      // 포인터
      if (cardLangTemplate[lang].pointer) {
        $('#cardPreview .pointer').text('*');
      }else {
        $('#cardPreview .pointer').text('');
      }
      // @ 기호
      if (cardLangTemplate[lang].atsign) {
        $('#cardPreview .atsign').text('@');
      }else {
        $('#cardPreview .atsign').text('');
      }
    }
  };
  // 언어 선택 선택지에 적용
  $('#selLanguage').change(function() {
    var lang = $(this).val();
    changeLanguage(lang);
  });

  /* 테마 변경 관련 함수 */
  var changeTheme = function(newTemplate) {
    if (typeof cardColorTemplate[newTemplate] == "object") {
      $('.nameTag').css('background-color', cardColorTemplate[newTemplate].bg);
      $('#cardPreview').css('color', cardColorTemplate[newTemplate].txt);
      $('#cardPreview .symbol').css('color', cardColorTemplate[newTemplate].txt);
      $('#cardPreview .varType').css('color', cardColorTemplate[newTemplate].varType);
      $('#cardPreview .varName').css('color', cardColorTemplate[newTemplate].varName);

      $('#cardPreview .name').css('color', cardColorTemplate[newTemplate].str);
      $('#cardPreview .atsign').css('color', cardColorTemplate[newTemplate].str);

      $('#cardPreview .comment').css('color', cardColorTemplate[newTemplate].comment);
    }else {
      console.log('잘못된 테마 이름 : ' + $(this).val());
    }
  };
  // 테마 변경 선택지에 적용
  $('#selTheme').change(function() {
    newTemplate = $(this).val();
    changeTheme(newTemplate);
  });

  // 이미지 팝업 생성
  $('input.generation').click(function() {
    html2canvas($("div.nameTag"), {
              onrendered: function(canvas) {
                // Canvas2Image를 이용해서 base64로 인코딩 된 png파일을 만든다.
                var imageData = Canvas2Image.saveAsPNG(canvas);
                
                $('#resultImage').html('<img src="'+imageData+'" class="center-block">');
                $('#resultArea').fadeIn('fast');
                $('#downloadBtn').attr('href', imageData);
                $('input.generation').fadeOut('fast');

                
            }
    });
  });

  // 모바일에서 보여지는 결과하면 토글 처리
  $('#resultArea').click(function(){
    $('input.generation').fadeIn('fast');
    $(this).fadeOut('fast');
  });
  $('#resultArea #downloadBtn').click(function(e) {
    e.stopPropagation();
  });
  // GET 파라미터
  // n : 이름
  // t : 테마
  // l : 언어
  // c : 회사
  // p : 직책

  // 트위터 공유하기 버튼 클릭 이벤트
  // 트위터 메시지를 보낼 수 있도록 기본 메시지를 입력하고 팝업창을 띄운다.
  $('input.share').click(function() {
    // 각 설정 값을 가져온다.
    var n = $('#InputName').val();
    var t = $('#selTheme').val();
    var l = $('#selLanguage').val();
    var c = $('#InputCorp').val();
    var p = $('#InputPosition').val();
    // 사이트 링크
    var url = "https://codenametag.github.io/";
    // 파라미터 생성
    var param = "?n="+n+"&t="+t+"&l="+l+"&c="+c+"&p="+p;
    // 트위터 메시지를 GET 파라미터 형태로 넘겨주므로 인코딩
    var twtMessage = encodeURIComponent("코드 스타일 명함을 만들어봤어요! " + url + param);
    // 트윗 날리기 주소의 GET 파라미터로 묶어주고,
    var popupUrl = "https://twitter.com/intent/tweet?text=" + twtMessage;
    // 팝업을 띄운다.
    var shareView = window.open(popupUrl, 'Twitter');
  });
  if (typeof getUrlParameter('n') != 'undefined') {
    // getp 함수 : 파라미터를 받아오고, 파라미터가 존재하지 않으면 공백, 존재하면 그것의 값을 반환
    // return은 문자형
    var getp = function(n) {
      var p = getUrlParameter(n);
      if (typeof p == 'undefined')
        return '';
      else
        return p;
    };
    // 각 파라미터의 값을 가져온다.
    var n = getp('n');
    var t = getp('t');
    var l = getp('l');
    var c = getp('c');
    var p = getp('p');

    // 선택지나 값을 설정해주고 및 수정 이벤트 발생(프리뷰 적용이 이벤트를 캐치하여 동작하므로.)
    $('#InputName').val(n).change();
    $('#selTheme').val(t).change();
    $('#selLanguage').val(l).change();
    $('#InputCorp').val(c).change();
    $('#InputPosition').val(p).change();
  }else {
    // GET 파라미터가 존재하지 않으면 기본 세팅으로 진행한다.
    console.log('GET 파라미터가 없으므로 기본 세팅으로 이루어집니다.');
    
    changeLanguage('c');
    changeTheme('default');
  }

  // information 말풍선 토글
  var showInfo = false;
  $('#infoToggle').click(function(e) {
  	e.stopPropagation();
    if(showInfo) {
      $('#informationBox').hide();
      showInfo = false;
    }else {
      $('#informationBox').show();
      showInfo = true;
    }
  });
  $('#informationBox').click(function() {
    if(showInfo) {
        $('#informationBox').hide();
        showInfo = false;
    }
  });
});
</script>
<!-- body 전체 container div-->
  </div>
    </body>

</html>
